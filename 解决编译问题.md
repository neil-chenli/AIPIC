# 解决 better-sqlite3 编译问题

## 当前问题

编译 `better-sqlite3` 需要：
1. ✅ Python 3.14.2 - 已安装
2. ❌ Visual Studio Build Tools - 未安装
3. ⚠️ 网络连接 - 可能有问题

## 解决方案

### 方案1：安装 Visual Studio Build Tools（推荐用于开发）

1. **下载 Build Tools**
   - 访问：https://visualstudio.microsoft.com/downloads/
   - 下载 "Build Tools for Visual Studio 2022"

2. **安装时选择工作负载**
   - 勾选 "C++ build tools"
   - 包含 Windows 10/11 SDK
   - 完成安装

3. **重新安装依赖**
   ```powershell
   cd C:\NeilData\AIPIC\aipic-web\server
   npm install
   ```

### 方案2：使用预编译版本（快速但可能不稳定）

尝试使用预编译的二进制文件：

```powershell
cd C:\NeilData\AIPIC\aipic-web\server
npm install better-sqlite3 --build-from-source=false
```

如果预编译版本不可用，可能需要等待网络恢复或使用 VPN。

### 方案3：使用替代数据库（临时方案）

如果编译问题持续，可以考虑：
- 暂时使用其他数据库（如 PostgreSQL）
- 或等待网络问题解决

### 方案4：手动下载并配置

1. **手动下载 Node.js headers**
   - 访问：https://nodejs.org/download/release/v24.12.0/
   - 下载 `node-v24.12.0-headers.tar.gz`
   - 解压到：`C:\Users\<用户名>\.node-gyp\24.12.0\`

2. **配置环境变量**
   ```powershell
   $env:npm_config_node_gyp = "C:\Users\<用户名>\.node-gyp\24.12.0"
   ```

## 快速检查清单

- [ ] Python 已安装 ✅
- [ ] Visual Studio Build Tools 已安装 ❌
- [ ] 网络连接正常 ⚠️
- [ ] 依赖安装成功 ❌

## 推荐步骤

1. **安装 Visual Studio Build Tools**（如果计划长期开发）
2. **检查网络连接**（确保能访问 nodejs.org）
3. **重试安装**：`npm install`

## 临时解决方案

如果急需启动项目，可以：

1. 暂时注释掉 `better-sqlite3` 相关代码
2. 使用内存数据库或文件系统存储
3. 等待编译环境配置完成

## 验证安装

安装 Build Tools 后，验证：

```powershell
# 检查 node-gyp
npm config get python
npm config get msvs_version

# 重新安装
npm install better-sqlite3
```

