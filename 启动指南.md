# AIPIC 项目启动指南

## 当前状态

✅ **前端服务器**: 已配置，可以启动  
⚠️ **后端服务器**: 需要解决 `better-sqlite3` 编译问题

## 问题说明

`better-sqlite3` 需要编译原生模块，但系统缺少 Python 环境。

## 解决方案

### 方案1：安装 Python（推荐）

1. 下载并安装 Python 3.6 或更高版本
   - 访问：https://www.python.org/downloads/
   - 安装时勾选 "Add Python to PATH"

2. 重新安装依赖：
   ```powershell
   cd aipic-web\server
   npm install
   ```

3. 启动后端服务器：
   ```powershell
   npm run dev
   ```

### 方案2：使用预编译二进制（快速）

如果不想安装 Python，可以尝试使用预编译版本：

```powershell
cd aipic-web\server
npm install better-sqlite3 --build-from-source=false
```

如果仍然失败，可以手动下载预编译版本。

### 方案3：使用 Docker（推荐用于生产环境）

如果本地环境配置困难，可以考虑使用 Docker 容器运行。

## 启动步骤

### 1. 启动后端服务器

```powershell
cd C:\NeilData\AIPIC\aipic-web\server
npm run dev
```

后端将在 `http://localhost:3001` 启动

### 2. 启动前端服务器（新终端窗口）

```powershell
cd C:\NeilData\AIPIC\aipic-web
npm run dev
```

前端将在 `http://localhost:5173` 启动（或Vite分配的端口）

## 验证启动

### 检查后端
```powershell
Invoke-WebRequest -Uri http://localhost:3001/health
```

应该返回：
```json
{"status":"ok","timestamp":"..."}
```

### 检查前端
打开浏览器访问：http://localhost:5173

### 检查API
```powershell
Invoke-WebRequest -Uri http://localhost:3001/api/v1
```

应该返回：
```json
{"message":"AIPIC API v1","version":"0.1.0"}
```

## 首次使用

1. 打开浏览器访问前端界面
2. 首次运行需要初始化 Owner 账户
3. 可以通过 API 初始化：
   ```powershell
   Invoke-WebRequest -Uri http://localhost:3001/api/v1/auth/init `
     -Method POST `
     -ContentType "application/json" `
     -Body '{"username":"admin","password":"yourpassword","email":"admin@example.com"}'
   ```

## 测试照片导入

使用 `picDATA` 目录测试照片导入功能：

```powershell
# 导入路径
C:\NeilData\AIPIC\picDATA
```

## 常见问题

### Q: better-sqlite3 编译失败
A: 需要安装 Python 3.6+，或使用预编译版本

### Q: 端口被占用
A: 检查并停止占用端口的进程：
```powershell
Get-NetTCPConnection -LocalPort 3001
Stop-Process -Id <进程ID>
```

### Q: 前端无法连接后端
A: 检查后端是否运行，以及 CORS 配置是否正确

## 项目结构

```
aipic-web/
├── server/          # 后端服务器
│   ├── src/
│   │   ├── index.ts      # 服务器入口
│   │   ├── routes/       # API路由
│   │   ├── services/     # 业务逻辑
│   │   └── lib/db/       # 数据库
│   └── package.json
└── src/             # 前端代码
    ├── pages/       # 页面组件
    ├── components/  # UI组件
    └── lib/api/     # API客户端
```

## 下一步

1. 解决 better-sqlite3 编译问题
2. 启动后端服务器
3. 启动前端服务器
4. 初始化 Owner 账户
5. 测试照片导入功能

